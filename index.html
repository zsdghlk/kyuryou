<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<title>給料計算ツール</title>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no" />
<style>
  body{margin:0;font-family:sans-serif;background:#f2f5f9;display:flex;justify-content:center}
  .card{width:min(96vw,760px);background:#fff;border-radius:14px;box-shadow:0 8px 24px rgba(0,0,0,.1);padding:20px;margin:20px}
  h1{text-align:center}
  .status,.salary,.total{padding:10px 12px;background:#f7f9fc;border:1px solid #e8eef7;border-radius:12px;margin:10px 0;font-weight:700}
  .salary,.total{background:#0b1020;color:#fff;text-align:center}
  .grid{display:grid;grid-template-columns:repeat(2,1fr);gap:10px}
  button{padding:12px;border:none;border-radius:10px;color:#fff;font-size:16px;cursor:pointer}
  .plus{background:#2563eb}.minus{background:#0ea5e9}.reset{background:#dc2626;grid-column:1/-1}.save-btn{background:#059669}.export-btn{background:#7c3aed}
  .months{margin-top:20px}
  .months-grid{display:grid;gap:8px}
  .month-item{display:flex;justify-content:space-between;align-items:center;padding:8px 10px;border:1px solid #e8eef7;border-radius:10px;background:#fbfdff}
  .month-label{font-weight:600;color:#334155}
  .month-value{display:flex;gap:6px;align-items:center}
  .month-input{width:100px;text-align:right;border:none;background:transparent;font-size:15px;padding:4px 6px;border-radius:6px}
  .month-unit{font-size:14px;color:#334155}
  .month-days{color:#64748b;font-size:13px}
</style>
</head>
<body>
<div class="card">
  <h1>給料計算ツール</h1>

  <div class="status">勤務日数: <span id="days">0</span> 日</div>

  <div class="grid">
    <button class="plus" onclick="addDay()">＋1日</button>
    <button class="minus" onclick="removeDay()">−1日</button>
    <button class="plus" onclick="addMoney()">＋1300円</button>
    <button class="minus" onclick="removeMoney()">−1300円</button>
    <button class="reset" onclick="resetData()">リセット</button>
  </div>

  <div class="salary" id="salary">給料：0 円</div>

  <div style="display:flex;gap:10px;margin:10px 0">
    <select id="monthSelect">
      <option value="1">1月</option><option value="2">2月</option><option value="3">3月</option>
      <option value="4">4月</option><option value="5">5月</option><option value="6">6月</option>
      <option value="7">7月</option><option value="8">8月</option><option value="9">9月</option>
      <option value="10">10月</option><option value="11">11月</option><option value="12">12月</option>
    </select>
    <button class="save-btn" onclick="saveToSelectedMonth()">この金額を保存</button>
  </div>

  <section class="months">
    <h2>月別データ</h2>
    <div class="months-grid" id="monthsGrid"></div>
    <div class="total" id="totalYear">年間合計：0 円</div>
  </section>

  <div style="display:flex;gap:10px;margin-top:10px">
    <button class="export-btn" onclick="printView()">印刷 / PDF保存</button>
    <button class="export-btn" onclick="exportCSV()">CSVダウンロード</button>
  </div>
</div>

<script>
const WAGE=1300,BASE_HOURS=7,EXTRA_STEP=1300;
let days=0,extraMoney=0;
let months={};

const fmtJPY=n=>Number(n||0).toLocaleString();
const onlyDigits=s=>(s||'').replace(/[^\d]/g,'');
const currentTotal=()=> (WAGE*BASE_HOURS*days)+extraMoney;

function render(){
  document.getElementById('days').textContent=days;
  document.getElementById('salary').textContent='給料：'+fmtJPY(currentTotal())+' 円';
}

function addDay(){days++;saveState();render();}
function removeDay(){if(days>0)days--;saveState();render();}
function addMoney(){extraMoney+=EXTRA_STEP;saveState();render();}
function removeMoney(){if(extraMoney>=EXTRA_STEP)extraMoney-=EXTRA_STEP;saveState();render();}
function resetData(){days=0;extraMoney=0;saveState();render();}

function saveToSelectedMonth(){
  const sel=document.getElementById('monthSelect').value;
  months[sel]={amount:currentTotal(),days:days};
  saveMonths();buildMonthsGrid();
}

function buildMonthsGrid(){
  const grid=document.getElementById('monthsGrid');grid.innerHTML='';
  let total=0;
  for(let m=1;m<=12;m++){
    const data=months[m]||{amount:0,days:0};
    total+=data.amount||0;
    const wrap=document.createElement('div');wrap.className='month-item';

    const label=document.createElement('div');label.className='month-label';label.textContent=m+'月';
    const valueWrap=document.createElement('div');valueWrap.className='month-value';

    const input=document.createElement('input');input.className='month-input';input.setAttribute('data-month',m);
    input.value=data.amount?fmtJPY(data.amount):'';
    input.addEventListener('input',e=>{
      const raw=onlyDigits(e.target.value);e.target.value=raw;
      months[m]={amount:raw===''?0:Number(raw),days:(months[m]?.days||0)};
      saveMonths();updateTotal();
    });
    input.addEventListener('blur',e=>{
      const raw=onlyDigits(e.target.value);e.target.value=raw?fmtJPY(raw):'';
    });
    input.addEventListener('focus',e=>{
      const raw=onlyDigits(e.target.value);e.target.value=raw;
      setTimeout(()=>{const len=e.target.value.length;e.target.setSelectionRange(len,len)},0);
    });

    const yen=document.createElement('div');yen.className='month-unit';yen.textContent='円';
    const daySpan=document.createElement('div');daySpan.className='month-days';daySpan.textContent=`(${data.days||0}日)`;

    valueWrap.appendChild(input);
    valueWrap.appendChild(yen);
    valueWrap.appendChild(daySpan);
    wrap.appendChild(label);wrap.appendChild(valueWrap);
    grid.appendChild(wrap);
  }
  document.getElementById('totalYear').textContent='年間合計：'+fmtJPY(total)+' 円';
}
function updateTotal(){let sum=0;for(let m=1;m<=12;m++){sum+=(months[m]?.amount||0)}document.getElementById('totalYear').textContent='年間合計：'+fmtJPY(sum)+' 円'}

function saveMonths(){localStorage.setItem('salaryMonths_v4',JSON.stringify(months));}
function loadMonths(){try{months=JSON.parse(localStorage.getItem('salaryMonths_v4'))||{}}catch{months={}}}
function saveState(){localStorage.setItem('salaryState_v2',JSON.stringify({days,extraMoney}));}
function loadState(){try{let s=JSON.parse(localStorage.getItem('salaryState_v2'));if(s){days=s.days||0;extraMoney=s.extraMoney||0}}catch{}}

function printView(){window.print();}
function exportCSV(){let rows=[['月','金額(円)','日数']];let sum=0;for(let m=1;m<=12;m++){const d=months[m]||{amount:0,days:0};rows.push([m,d.amount||0,d.days||0]);sum+=d.amount||0}rows.push(['合計',sum]);const csv=rows.map(r=>r.join(',')).join('\n');const a=document.createElement('a');a.href=URL.createObjectURL(new Blob([csv],{type:'text/csv'}));a.download='salary.csv';a.click();}

(function init(){loadMonths();loadState();buildMonthsGrid();render();})();
</script>
</body>
</html>